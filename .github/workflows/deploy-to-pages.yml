name: Build and Deploy to GitHub Pages

on:
  push:
    branches:
      - master  # Trigger on changes to the master branch

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.8'  # Use a specific Python version

    - name: Install Python Dependencies
      if: exists('requirements.txt')
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt

    - name: Build Website
      run: |
        mkdir build
        cp -R frontend/templates/* build/
        cp -R frontend/static build/static

    - name: Deploy to GitHub Pages
      uses: JamesIves/github-pages-deploy-action@4.1.4
      with:
        branch: gh-pages  # The target deployment branch
        folder: build     # Directory containing built site files
        clean: true       # Clean out old files on deployment branch
        commit-message: 'Deploying to gh-pages'  # Custom commit message

    - name: Cleanup Post-deployment
      if: always()
      run: rm -rf build
